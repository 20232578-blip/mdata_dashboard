<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영화 정보 UI 구현</title>
    <!-- 폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 아이콘 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- WordCloud2.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>

    <style>
        /* --- 기본 설정 --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            color: #333;
            background-color: #fff;
        }

        .container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- [New] 상단 고정 헤더 이미지 --- */
        .header-image-wrapper {
            top: 0;
            z-index: 1000;
            /* 다른 요소보다 위에 배치 */
            width: 100%;
            background-color: #fff;
            /* 배경 투명 방지 */
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            /* 살짝 그림자 */
        }

        .header-image {
            width: 100%;
            max-width: 980px;
            /* 본문 폭과 맞춤 */
            height: auto;
            display: block;
        }

        /* --- 상단 탭 --- */
        .tab-nav {
            width: 100%;
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #e0e0e0;
            background-color: #fff;
        }

        .tab-inner {
            width: 100%;
            max-width: 980px;
            display: flex;
        }

        .tab-item {
            flex: 1;
            text-align: center;
            padding: 14px 0;
            font-size: 15px;
            color: #888;
            cursor: pointer;
            letter-spacing: -0.5px;
        }

        .tab-item.active {
            color: #000;
            font-weight: 700;
            border-bottom: 2px solid #000;
            margin-bottom: -1px;
        }

        /* --- 콘텐츠 영역 --- */
        .content-area {
            width: 100%;
            background-color: #f8f8f8;
            padding: 40px 0 100px 0;
            display: flex;
            justify-content: center;
            border-top: 1px solid #e0e0e0;
            margin-top: -1px;
            min-height: 600px;
        }

        .content-inner {
            width: 100%;
            max-width: 980px;
            padding: 0 20px;
        }

        h2.section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            color: #000;
            letter-spacing: -0.5px;
        }

        /* --- 상세정보 뷰 (기존) --- */
        #detail-view {
            display: block;
        }

        /* 정보 리스트 */
        .info-list {
            list-style: none;
            font-size: 14px;
            line-height: 2.0;
            letter-spacing: -0.2px;
            margin-bottom: 40px;
        }

        .info-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 2px;
        }

        .label {
            color: #666;
            width: 50px;
            display: flex;
            align-items: center;
            font-weight: 400;
            margin-right: 10px;
        }

        .label::before {
            content: '·';
            margin-right: 4px;
            font-weight: bold;
            color: #999;
        }

        .value {
            color: #333;
            flex: 1;
        }

        .link-text {
            text-decoration: underline;
            text-underline-offset: 3px;
            text-decoration-color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
        }

        .link-text:hover {
            color: #000;
            text-decoration-color: #000;
        }

        .separator {
            margin: 0 2px;
            color: #333;
            display: inline-block;
        }

        /* --- AI Dashboard Styles --- */
        .ai_dashboard {
            margin-top: 20px;
            background-color: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
        }

        .ai_header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .ai_title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai_badge {
            background: #000;
            color: #fff;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            vertical-align: middle;
        }

        .dash_row {
            display: flex;
            gap: 20px;
        }

        .dash_card {
            flex: 1;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            position: relative;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        /* --- Score Card (White Theme with Circular Progress) --- */
        .dash_card.score {
            align-items: center;
            text-align: center;
            background: #fff;
            border: 1px solid #eee;
            color: #333;
            position: relative;
            overflow: hidden;
            /* 상단 정렬로 변경하여 라벨 위치 제어 */
            justify-content: flex-start;
        }

        /* 기존 장식 요소 제거 */
        .dash_card.score::before,
        .dash_card.score::after {
            display: none;
        }

        .score_label {
            width: 100%;
            text-align: left;
            /* 왼쪽 정렬하여 옆 카드 타이틀과 위치 맞춤 */
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 2;
            /* 옆 카드의 .chart_tit와 높이/마진을 맞춤 */
            height: 24px;
            display: flex;
            align-items: center;
        }

        /* 아이콘 스타일 추가 */
        .score_label i {
            margin-right: 6px;
            color: #FF243E;
        }

        /* 원형 프로그레스 바 컨테이너 */
        .score-circle {
            position: relative;
            width: 160px;
            /* 크기 확대 */
            height: 160px;
            /* 크기 확대 */
            border-radius: 50%;
            /* 5.8점 = 58% 채움 (메인 레드 #FF243E) */
            background: conic-gradient(#FF243E 0% 58%, #eee 58% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            /* 위쪽은 auto로 밀고, 아래쪽 여백은 최소화 */
            margin-top: auto;
            margin-bottom: 0;
        }

        /* 도넛 구멍 (흰색 원) */
        .score-circle::before {
            content: '';
            position: absolute;
            width: 136px;
            /* 내부 원 크기 (두께 유지/조절) */
            height: 136px;
            background: #fff;
            border-radius: 50%;
        }

        /* 점수 텍스트 래퍼 */
        .score-text-wrap {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1;
        }

        .score_val {
            font-size: 42px;
            /* 폰트 사이즈 확대 */
            font-weight: 800;
            color: #333;
            margin-bottom: 0;
        }

        .score_val span {
            font-size: 16px;
            color: #999;
            font-weight: 500;
            margin-left: 2px;
        }

        .tag_box {
            display: flex;
            gap: 8px;
            position: relative;
            z-index: 2;
            /* 원형 그래프와 더 가깝게 음수 마진 적용 */
            margin-top: 30px;
            margin-bottom: auto;
            /* 하단 여백 */
        }

        .tag_box span {
            background: #f5f5f5;
            color: #555;
            font-size: 14px;
            /* 글자 크기 확대 */
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        /* Chart Common */
        .chart_tit {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
            font-weight: 700;
            color: #333;
            width: 100%;
            height: 24px;
        }

        .chart_tit i {
            margin-right: 6px;
            color: #FF243E;
        }

        .radar_btns {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .radar_btns button {
            flex: 1;
            max-width: 100px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 8px 0;
            font-size: 12px;
            cursor: pointer;
            color: #777;
            font-family: 'Noto Sans KR', sans-serif;
            transition: all 0.2s;
        }

        .radar_btns button:hover {
            background: #eee;
        }

        .radar_btns button.on {
            background: #333;
            color: #fff;
            border-color: #333;
            font-weight: 700;
        }

        /* Radar Summary (한줄평) */
        .radar-summary {
            margin-top: 12px;
            padding: 10px 12px;
            background: #fdfdfd;
            border: 1px solid #eee;
            border-radius: 6px;
            font-size: 12px;
            color: #555;
            text-align: center;
            line-height: 1.4;
            letter-spacing: -0.3px;
        }


        /* --- 관람평 뷰 (신규) --- */
        #review-view {
            display: none;
        }

        /* 1. Word Cloud Section */
        .review-wordcloud-box {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        #cloud-wrapper {
            width: 100%;
            height: 200px;
            position: relative;
        }

        /* 2. Comment Write Section */
        .comment-write-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            /* 전체 박스 둥글게 */
            padding: 15px 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .comment-input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .comment-textarea {
            width: 100%;
            height: 60px;
            border: none;
            resize: none;
            font-size: 14px;
            font-family: 'Noto Sans KR', sans-serif;
            outline: none;
            padding: 5px 0;
            color: #333;
        }

        .comment-textarea::placeholder {
            color: #bbb;
        }

        .comment-btn {
            width: 90px;
            height: 70px;
            /* 버튼 높이를 조금 키워서 균형 맞춤 */
            background-color: #FF243E;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .comment-btn:hover {
            background-color: #d91028;
        }

        /* Review List Header */
        .review-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .total-count {
            font-size: 15px;
            font-weight: 700;
            color: #000;
        }

        .total-count span {
            color: #FF243E;
        }

        .sort-opts {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #888;
        }

        .sort-item {
            cursor: pointer;
        }

        .sort-item.active {
            color: #000;
            font-weight: 700;
        }

        .review-list {
            list-style: none;
        }

        .review-item {
            background: #fff;
            padding: 25px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* 상단: 평점 영역 */
        .review-top {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stars {
            color: #FF243E;
            font-size: 16px;
            letter-spacing: -1px;
        }

        .score-num {
            font-weight: 800;
            font-size: 15px;
            color: #000;
            margin-left: 2px;
        }

        /* 내용: 텍스트 */
        .review-body {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            word-break: break-all;
        }

        /* 하단: 작성자 및 공감 버튼 */
        .review-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #999;
        }

        .meta-left {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-id {
            color: #555;
        }

        .bar {
            color: #ddd;
        }

        .like-btn {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 5px 12px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .like-btn:hover {
            border-color: #bbb;
            color: #333;
        }

        .like-btn i {
            color: #999;
            font-size: 13px;
        }

        .like-btn.on i {
            color: #FF243E;
        }

        .like-btn.on {
            border-color: #FF243E;
            color: #FF243E;
        }


        /* Mobile Responsive */
        @media (max-width: 768px) {

            .tab-inner,
            .content-inner {
                width: 100%;
                padding: 0 16px;
            }

            .tab-item {
                font-size: 14px;
                padding: 12px 0;
            }

            .dash_row {
                flex-direction: column;
                gap: 15px;
            }

            .ai_header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .dash_card.score {
                padding: 30px 20px;
            }

            .comment-write-box {
                flex-direction: column;
                align-items: stretch;
            }

            .comment-btn {
                width: 100%;
                height: 50px;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- [New] 상단 고정 헤더 이미지 -->
        <div class="header-image-wrapper">
            <img src="./부고니아 상단.png" alt="Movie Header Image" class="header-image"
                onerror="this.style.backgroundColor='#eee'; this.style.height='200px'; this.alt='[이미지 로드 실패] 여기에 이미지가 표시됩니다.';">
        </div>

        <!-- 상단 탭 -->
        <nav class="tab-nav">
            <div class="tab-inner">
                <div class="tab-item active" onclick="switchTab('detail', this)">상세정보</div>
                <div class="tab-item" onclick="switchTab('review', this)">관람평 (1,165)</div>
            </div>
        </nav>

        <!-- 콘텐츠 영역 -->
        <section class="content-area">
            <div class="content-inner">

                <!-- 1. 상세정보 뷰 -->
                <div id="detail-view">
                    <h2 class="section-title">영화정보</h2>
                    <ul class="info-list">
                        <li>
                            <span class="label">장르</span>
                            <span class="value">스릴러, 코미디 / 미국</span>
                        </li>
                        <li>
                            <span class="label">감독</span>
                            <span class="value">
                                <span class="link-text">요르고스 란티모스</span>
                            </span>
                        </li>
                        <li>
                            <span class="label">출연</span>
                            <span class="value">
                                <span class="link-text">엠마 스톤</span><span class="separator">,</span>
                                <span class="link-text">제시 플레먼스</span><span class="separator">,</span>
                                <span class="link-text">에이든 델비스</span><span class="separator">,</span>
                                <span class="link-text">알리시아 실버스톤</span>
                            </span>
                        </li>
                    </ul>

                    <!-- AI Dashboard -->
                    <div class="ai_dashboard">
                        <div class="ai_header">
                            <div class="ai_title">
                                <span class="ai_badge">BETA</span>Charlotte 리뷰 인사이트
                            </div>
                            <div style="font-size:12px; color:#999;">데이터 기준: 2025.12.15 23:59</div>
                        </div>

                        <div class="dash_row">
                            <!-- Score Card (White Theme with Circular Progress) -->
                            <div class="dash_card score">
                                <!-- 라벨 위치 상단, 왼쪽 정렬 + 아이콘 추가 -->
                                <div class="score_label"><i class="fa-solid fa-star"></i> 실관람 평점</div>

                                <!-- 원형 프로그레스 바 (크기 확대, 하단 여백 제거) -->
                                <div class="score-circle">
                                    <div class="score-text-wrap">
                                        <div class="score_val">5.8<span>/10</span></div>
                                    </div>
                                </div>

                                <div class="tag_box">
                                    <span>긍정 우세</span>
                                    <span>영상미 호평</span>
                                </div>
                            </div>

                            <!-- Radar Chart -->
                            <div class="dash_card">
                                <div class="chart_tit">
                                    <span><i class="fa-solid fa-chart-pie"></i> 무비 스펙트럼 레이더</span>
                                </div>
                                <div style="height:180px; display:flex; justify-content:center; align-items:center;">
                                    <canvas id="spectrumChart"></canvas>
                                </div>
                                <div class="radar_btns">
                                    <button class="on" onclick="switchChart('aspect', this)">관람 포인트</button>
                                    <button onclick="switchChart('emotion', this)">감성 포인트</button>
                                </div>
                                <!-- [New] 한줄평 영역 -->
                                <div id="radar-summary" class="radar-summary"></div>
                            </div>
                            <!-- Trend Chart -->
                            <div class="dash_card">
                                <div class="chart_tit">
                                    <span><i class="fa-solid fa-arrow-trend-up"></i> 일별 리뷰 추이</span>
                                    <span style="font-size:11px; color:#999; font-weight:400;">최근 30일</span>
                                </div>
                                <div style="height:200px;">
                                    <canvas id="trendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End AI Dashboard -->
                </div>

                <!-- 2. 관람평 뷰 -->
                <div id="review-view">
                    <!-- 워드 클라우드 영역 -->
                    <div class="review-wordcloud-box">
                        <div class="chart_tit" style="margin-bottom:10px;">
                            <span><i class="fa-solid fa-quote-left"></i> 키워드 하이라이트</span>
                        </div>
                        <div id="cloud-wrapper">
                            <canvas id="wordCloudCanvas"></canvas>
                        </div>
                    </div>

                    <!-- 댓글 작성 영역 -->
                    <div class="comment-write-box">
                        <div class="comment-input-area">
                            <textarea class="comment-textarea" placeholder="영화에 대한 솔직한 평을 남겨주세요."></textarea>
                        </div>
                        <button class="comment-btn">등록</button>
                    </div>

                    <!-- 댓글 리스트 헤더 -->
                    <div class="review-header-bar">
                        <div class="total-count">총 <span>1,165</span>건</div>
                        <div class="sort-opts">
                            <div class="sort-item active">공감순</div>
                            <div style="color:#ddd">|</div>
                            <div class="sort-item">최신순</div>
                        </div>
                    </div>

                    <ul class="review-list">
                        <!-- Review Item 1 -->
                        <li class="review-item">
                            <div class="review-top">
                                <div class="stars">★★★★★</div>
                                <div class="score-num">10</div>
                            </div>
                            <div class="review-body">
                                역시 요르고스 란티모스 감독! 엠마 스톤 연기 미쳤네요. 기괴하면서도 유머러스한 연출이 돋보였습니다. <br>특히 색감이 너무 예뻐서 눈이 즐거웠어요.
                                호불호는 갈릴 수 있겠지만 저는 극호!
                            </div>
                            <div class="review-meta">
                                <div class="meta-left">
                                    <span class="user-id">movi****</span>
                                    <span class="bar">|</span>
                                    <span class="date">2025.12.16 09:30</span>
                                </div>
                                <button class="like-btn" onclick="toggleLike(this)">
                                    <i class="fa-regular fa-thumbs-up"></i>
                                    <span class="count">342</span>
                                </button>
                            </div>
                        </li>

                        <!-- Review Item 2 -->
                        <li class="review-item">
                            <div class="review-top">
                                <div class="stars">★★★★☆</div>
                                <div class="score-num">8</div>
                            </div>
                            <div class="review-body">
                                지구를 구하려는 주인공들의 여정이 흥미진진했습니다. 원작과는 또 다른 매력이 있네요. <br>중반부가 살짝 늘어지는 감이 있지만 결말이 좋았습니다.
                            </div>
                            <div class="review-meta">
                                <div class="meta-left">
                                    <span class="user-id">cine****</span>
                                    <span class="bar">|</span>
                                    <span class="date">2025.12.15 22:15</span>
                                </div>
                                <button class="like-btn" onclick="toggleLike(this)">
                                    <i class="fa-regular fa-thumbs-up"></i>
                                    <span class="count">128</span>
                                </button>
                            </div>
                        </li>
                        <!-- Review Item 3 -->
                        <li class="review-item">
                            <div class="review-top">
                                <div class="stars">★★★☆☆</div>
                                <div class="score-num">6</div>
                            </div>
                            <div class="review-body">
                                난해하다... 무슨 말을 하려는지 알겠는데 너무 빙빙 돌리는 느낌. <br>배우들 연기는 좋았지만 스토리가 좀 아쉽네요.
                            </div>
                            <div class="review-meta">
                                <div class="meta-left">
                                    <span class="user-id">user****</span>
                                    <span class="bar">|</span>
                                    <span class="date">2025.12.15 18:40</span>
                                </div>
                                <button class="like-btn" onclick="toggleLike(this)">
                                    <i class="fa-regular fa-thumbs-up"></i>
                                    <span class="count">56</span>
                                </button>
                            </div>
                        </li>

                        <!-- Review Item 4 -->
                        <li class="review-item">
                            <div class="review-top">
                                <div class="stars">★★★★★</div>
                                <div class="score-num">10</div>
                            </div>
                            <div class="review-body">
                                올해 최고의 영화! 영상미, 음악, 연기 삼박자가 완벽합니다. <br>극장에서 꼭 보세요. 사운드가 압권입니다.
                            </div>
                            <div class="review-meta">
                                <div class="meta-left">
                                    <span class="user-id">gold****</span>
                                    <span class="bar">|</span>
                                    <span class="date">2025.12.15 14:20</span>
                                </div>
                                <button class="like-btn" onclick="toggleLike(this)">
                                    <i class="fa-regular fa-thumbs-up"></i>
                                    <span class="count">89</span>
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>

            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script>
        // --- 탭 전환 로직 ---
        function switchTab(tabName, element) {
            // 탭 스타일 활성화
            const tabs = document.querySelectorAll('.tab-item');
            tabs.forEach(t => t.classList.remove('active'));
            element.classList.add('active');

            // 콘텐츠 표시 전환
            const detailView = document.getElementById('detail-view');
            const reviewView = document.getElementById('review-view');

            if (tabName === 'detail') {
                detailView.style.display = 'block';
                reviewView.style.display = 'none';
                // 상세정보 차트 리사이즈
                if (radarChart) setTimeout(() => radarChart.resize(), 100);
            } else {
                detailView.style.display = 'none';
                reviewView.style.display = 'block';

                // 관람평 탭으로 왔을 때 워드클라우드 그리기 (보이는 상태여야 사이즈 계산 가능)
                setTimeout(() => drawWordCloud(), 100);
            }
        }

        // --- 좋아요 토글 로직 ---
        function toggleLike(btn) {
            btn.classList.toggle('on');
            const icon = btn.querySelector('i');
            const countSpan = btn.querySelector('.count');
            let count = parseInt(countSpan.innerText.replace(/,/g, ''));

            if (btn.classList.contains('on')) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
                count++;
            } else {
                icon.classList.remove('fa-solid');
                icon.classList.add('fa-regular');
                count--;
            }
            countSpan.innerText = count.toLocaleString();
        }

        // --- 차트 & 워드클라우드 데이터 (CSV 기반 업데이트) ---
        // CSV 데이터: 영상미(10.0), OST(7.8), 배우/연기(7.5), 감독/연출(6.4), 스토리(6.1), 자극/충격(3.1), 신선/독창(3.1) 등
        const keywords = [
            { word: "영상미", weight: 150 },    // 관람포인트 1위
            { word: "부고니아", weight: 130 },  // 영화 제목
            { word: "엠마스톤", weight: 125 },  // 주연 배우
            { word: "OST", weight: 115 },       // 관람포인트 2위
            { word: "독창적", weight: 100 },    // 감성지표 반영
            { word: "배우/연기", weight: 95 },  // 관람포인트 3위
            { word: "요르고스", weight: 90 },   // 감독
            { word: "미장센", weight: 85 },     // 영상미 연관
            { word: "스토리", weight: 80 },
            { word: "신선함", weight: 75 },
            { word: "충격적", weight: 70 },
            { word: "지구를지켜라", weight: 65 }, // 원작
            { word: "색감", weight: 60 },
            { word: "호불호", weight: 55 },
            { word: "블랙코미디", weight: 50 },
            { word: "감독/연출", weight: 45 },
            { word: "결말", weight: 40 },
            { word: "분위기", weight: 35 }
        ];

        const chartConfig = {
            aspect: { labels: ['감독/연출', '배우/연기', '스토리', '영상미', 'OST'], data: [6.4, 7.5, 6.1, 10.0, 7.8] },
            emotion: { labels: ['긴장감/공포', '자극/충격', '유머/재미', '감동/여운', '신선/독창'], data: [0.5, 3.1, 2.6, 1.9, 3.1] }
        };

        // [New] AI 한줄평 데이터 (수정됨: "AI 분석:" 삭제)
        const summaryText = {
            aspect: "압도적인 <span style='color:#FF243E'>영상미</span>와 <span style='color:#FF243E'>OST</span>, 배우들의 호연이 어우러진 시청각적 걸작",
            emotion: "예측불가한 스토리와 <span style='color:#FF243E'>신선한 충격</span>이 주는 블랙코미디의 진수"
        };

        let radarChart = null;

        // --- 워드클라우드 그리기 함수 ---
        function drawWordCloud() {
            const cloudCv = document.getElementById('wordCloudCanvas');
            const cloudWrap = document.getElementById('cloud-wrapper');

            if (!cloudCv || !cloudWrap) return;

            // 캔버스 크기 부모에 맞춤
            cloudCv.width = cloudWrap.offsetWidth;
            cloudCv.height = cloudWrap.offsetHeight;

            // 포인트 컬러 적용할 키워드 목록
            const highlightWords = ['영상미', '부고니아', 'OST', '독창적', '엠마스톤'];

            WordCloud(cloudCv, {
                list: keywords.map(k => [k.word, k.weight]),
                gridSize: 16, // 간격 조정
                weightFactor: function (size) { return Math.pow(size, 1.9) * cloudCv.width / 180000; }, // 크기 비율 조정
                fontFamily: 'Noto Sans KR',
                fontWeight: '700',
                // 컬러 설정: 하이라이트 단어는 레드, 나머지는 짙은 회색/검정 계열
                color: function (word, weight) {
                    if (highlightWords.includes(word)) {
                        return '#FF243E'; // 메인 레드
                    }
                    // 나머지는 자연스러운 모노톤 랜덤
                    return Math.random() > 0.5 ? '#333' : '#666';
                },
                backgroundColor: 'transparent',
                rotateRatio: 0, // 회전 없음
                shape: 'circle',
                shuffle: false // 큰 단어가 중앙에 오도록 셔플 끔
            });
        }

        // --- 차트 초기화 ---
        function initCharts() {
            // Trend Chart (Updated Data: 2025-11-05 ~ 12-15 Full Data)
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: [
                            '11.05', '11.07', '11.11', '11.13', '11.14',
                            '11.17', '11.22', '11.23', '11.27', '11.30', '12.07', '12.15'
                        ],
                        datasets: [{
                            data: [
                                76, 101, 44, 22, 43,
                                51, 13, 29, 11, 24, 15, 3
                            ],
                            borderColor: '#FF243E', backgroundColor: 'rgba(255, 36, 62, 0.1)', fill: true, tension: 0.4, pointRadius: 2, pointBackgroundColor: '#fff', borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: {
                                grid: { display: false },
                                ticks: {
                                    font: { size: 10 },
                                    maxTicksLimit: 7 // x축 라벨이 너무 많아 겹치지 않도록 제한
                                }
                            },
                            y: { display: false }
                        }
                    }
                });
            }

            // Radar Chart Initial Render
            renderRadar('aspect');
        }

        function renderRadar(type) {
            const ctx = document.getElementById('spectrumChart');
            if (!ctx) return;

            // 차트 업데이트
            if (radarChart) {
                radarChart.data.labels = chartConfig[type].labels;
                radarChart.data.datasets[0].data = chartConfig[type].data;
                radarChart.update();
            } else {
                radarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: chartConfig[type].labels,
                        datasets: [{
                            data: chartConfig[type].data,
                            backgroundColor: 'rgba(255, 36, 62, 0.2)', borderColor: '#FF243E', pointBackgroundColor: '#FF243E', borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { r: { angleLines: { color: '#eee' }, grid: { color: '#eee' }, pointLabels: { font: { size: 11, family: 'Noto Sans KR' }, color: '#333' }, ticks: { display: false, max: 10, beginAtZero: true } } },
                        plugins: { legend: { display: false } },
                        animation: { duration: 1000, easing: 'easeInOutQuart' }
                    }
                });
            }

            // [New] 한줄평 업데이트
            const summaryEl = document.getElementById('radar-summary');
            if (summaryEl && summaryText[type]) {
                summaryEl.innerHTML = summaryText[type];
            }
        }

        window.switchChart = function (type, btn) {
            const btns = document.querySelectorAll('.radar_btns button');
            btns.forEach(b => b.classList.remove('on'));
            btn.classList.add('on');
            renderRadar(type);
        }

        window.onload = initCharts;

        let resizeTimer;
        window.onresize = () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (radarChart) radarChart.resize();

                // 관람평 탭이 활성화 상태라면 워드클라우드도 리사이즈
                if (document.getElementById('review-view').style.display === 'block') {
                    drawWordCloud();
                }
            }, 200);
        };
    </script>
</body>

</html>